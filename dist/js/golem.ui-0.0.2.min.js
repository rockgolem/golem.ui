this.Golem=this.Golem||{},function(t,e,i,s,n){"use strict";var o,a,r,h=/\s+/;o={},o.checkExists=function(e,s,n){var o,a;return o=s||t,i.isArray(e)?i.each(e,function(e){return i.each(e.split("."),function(t){o=o[t]}),a=!i.isUndefined(o),r(e,a,n),o=s||t,a},this):(i.each(e.split("."),function(t){o=o[t]}),a=!i.isUndefined(o),r(e,a,n)),a},a={},a.on=function(t,e,s){var n,o;return i.isFunction(e)&&(t=t.split(h),n=this._eventRegistry||(this._eventRegistry={}),i.each(t,function(t){o=n[t]||(n[t]=[]),o.push(e,s)})),this},a.off=function(t,e,s){var n,o,a;return n=this._eventRegistry,n&&(t||e||s?(t=t?t.split(h):i.keys(n),i.each(t,function(t){if(o=n[t],o&&(e||s))for(a=o.length-2;a>=0;a-=2)e&&o[a]!==e||s&&o[a+1]!==s||o.splice(a,2);else delete n[t]})):delete this._eventRegistry),this},a.emit=function(t){var e,s,n,o,a,r,c;if(e=this._eventRegistry){for(c=[],t=t.split(h),n=1,o=arguments.length;o>n;n++)c[n-1]=arguments[n];i.each(t,function(t){if(r=(e.all||[]).slice(),s=(e[t]||[]).slice(),s.length)for(n=0,o=s.length;o>n;n+=2)s[n].apply(s[n+1]||this,c);if(r.length)for(a=[t].concat(c),n=0,o=r.length;o>n;n+=2)r[n].apply(r[n+1]||this,a)})}return this},o.EventEmitter=a,r=function(t,e,i){i||e||console.log(t+" is undefined.")},i.extend(t.Golem,{Util:o});var c;c=function(t){Golem.Util.checkExists(["createjs.PreloadJS"]),this.p=new s.PreloadJS,this.manifest=i.isUndefined(t)?[]:t,this.head=e.getElementsByTagName("head")[0],this.body=e.body,this.loaded=!1},c.prototype.addAsset=function(t,e){var s=this.loaded;return i.isArray(t)?this.manifest=this.manifest.concat(t):this.manifest.push(t),(s||i.isFunction(e))&&this.load(e),s},c.prototype.init=function(t){this.p.onFileLoad=i.bind(this.handleFile,this),this.load(t)},c.prototype.load=function(t){var e=this.p;this.loaded=!0,e.onComplete=this.getCallback(t),e.loadManifest(this.manifest)},c.prototype.handleFile=function(t){var i=s.PreloadJS;switch(t.type){case i.CSS:this.head.appendChild(t.result);break;case i.JAVASCRIPT:e.body.appendChild(t.result);break;case i.SOUND:this.body.appendChild(t.result);break;case i.IMAGE:break;case i.JSON:break;case i.XML:}},c.prototype.getCallback=function(e){var s,n,o;return n=this.p,o=this.manifest,e=i.isFunction(e)?e:function(){},s=i.bind(function(){var n=i.all(o,function(e){var s,n;return"js"===i.last(e.src.split("."))?(s=e.id.split("."),n=t,i.each(s,function(t){n=n[t]})):n=!0,!i.isUndefined(n)});n?(this.manifest=[],e()):setTimeout(s,1)},this)},i.extend(t.Golem,{Preload:c});var p,d;p=function(t){this.widgets=[],t=t||{},this.canvas=t.canvas||p.createCanvas(),this.options=i.extend({},t,{canvas:n}),this.prepareCanvas(),this.loadStage(),this.resizeCanvas(),this.setupTicker(t)},p.prototype.addWidget=function(t){var e,i=p.Widget,s=this.stage;return e=t instanceof i?t:i.buildWidget(t,s),this.widgets.push(e),s.addChild(e.displayObject),e},p.prototype.loadStage=function(t){var e=this.canvas;e&&(t=t||this.options.stage||new s.Stage(e)),this.stage=t},p.prototype.prepareCanvas=function(){$(this.canvas).addClass("golem-stage"),t.onresize=i.bind(this.resizeCanvas,this)},p.prototype.render=function(){this.startTicker(),this.renderWidgets()},p.prototype.renderWidgets=function(){this.repositionWidgets(),i.each(this.widgets,function(t){t.render()})},p.prototype.resizeCanvas=function(){var e,s,n,o,a,r,h,c,p,d,l,u;s=this.canvas,e=this.options,c=t.innerWidth,p=t.innerHeight,d=c/p,l=e.viewportRatio||.98,h=e.aspectRatio||8/6,h>=d?(n=c*l,o=n/h):(o=p*l,n=o*h),a=((c-n)/2).toFixed(0),r=((p-o)/2).toFixed(0),i.extend(s.style,{position:"fixed",left:a+"px",top:r+"px"}),s.setAttribute("width",n),s.setAttribute("height",o),u=this.stage,this.left=parseInt(a,10),this.top=parseInt(r,10),this.width=n,this.height=o,this.repositionWidgets()},p.prototype.repositionWidgets=function(){var t,e;t=this.left,e=this.top,i.each(this.widgets,function(s){s.reposition(t,e),i.each(s.children,function(i){i.reposition(t,e)})})},d=function(){this.stage.update()},p.prototype.startTicker=function(){s.Ticker.addListener(i.bind(d,this))},p.prototype.setupTicker=function(t){var e=s.Ticker;t=i.extend({},t),e.useRAF=t.useRAF||!0,e.setFPS(t.FPS||60)},p.createCanvas=function(){var t=e.createElement("canvas");return t},i.extend(t.Golem,{UI:p});var l,u,g,f,m,y,v,b,w;l=function(t){this.stage=t},l.prototype=Object.create(Golem.Util.EventEmitter),l.buildWidget=function(t,e){var i=new x[t.type](t,e);return i},l.prototype.children=[],l.prototype.addChild=function(t){this.children.push(t)},l.prototype.getNormalizedX=function(){return l.getNormalizedPositionValue(this.optionX,this.width,$(this.stage.canvas).width(),this.offsetX)},l.prototype.getNormalizedY=function(){return l.getNormalizedPositionValue(this.optionY,this.height,$(this.stage.canvas).height(),this.offsetY)},l.getNormalizedPositionValue=function(t,e,s,n){if(i.isString(t))switch(n=n||0,t){case"top":case"left":t=n;break;case"middle":t=(s-e)/2+n;break;case"right":case"bottom":t=s-e-n}return parseInt(t,10)},l.prototype.render=function(){},l.prototype.setupHTML=function(t){var i,n,o,a,r;o=["golem-widget"].concat(t.classes),t.className&&o.push(t.className),i=e.createElement("div"),this.optionX=t.x,this.optionY=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,a=this.getNormalizedX(),r=this.getNormalizedY(),n=new s.DOMElement(i),n.x=a,n.x=r,this.x=a,this.y=r,this.isHTML=!0,this.el=i,this.displayObject=n,$(this.el).css({height:this.height,width:this.width}).addClass(o.join(" "))},l.prototype.setupSpriteSheet=function(t){i.isUndefined(t)||(this.spriteSheet=new s.SpriteSheet(t),console.log(this.spriteSheet))},l.prototype.setWidthHeight=function(){var t,e,i,s;t=this.spriteSheet,e=this.dimensions,i=t._frameWidth*e[1],s=t._frameHeight*e[0],this.width=i,this.height=s},Golem.UI.Widget=l,u=function(){this.setDimensions(1,4)},u.prototype=Object.create(l.prototype),u.prototype.list=[],u.prototype.overflow=[],u.prototype.setDimensions=function(t,e){var s,n;return n=this.lastIndex=t*e-1,s=i.compact(this.list),this.dimensions=[t,e],s.length>n?this.addToOverflow(s.splice(n)):s.length=n+1,this.list=s,this},u.prototype.addToOverflow=function(t){var e=this.overflow;i.isArray(t)||e.push(t),this.emit("overflow",t,e)},u.prototype.add=function(t,e){var s,n,o,a,r,h;if(o=this.lastIndex,s=this.list,i.isObject(e))e=this.getPosition(e);else if(i.isUndefined(e))for(e=-1,r=s.length,a=0;r>=a;++a)if(i.isUndefined(s[a])){e=a;break}return h={item:t,index:e,lastIndex:o},o>=e?(n=s[e],s[e]=t,i.extend(h,{type:"add",replaced:n})):i.extend(h,{type:"outOfBounds"}),this.emit(h.type,h),this},u.prototype.get=function(t){var e;return i.isObject(t)&&(t=this.getPosition(t)),e=this.list[t]},u.prototype.getPosition=function(t){var e,s,n,o;return e=this.dimensions[1],i.isObject(t)?o=(t.row-1)*e+t.column-1:(s=this.dimensions[0],n=Math.floor(t/e)+1,o={row:n,column:t-(n-1)*e+1}),o},g=function(){},g.prototype=Object.create(l.prototype),f=function(){},f.prototype=Object.create(l.prototype),m=function(){},m.prototype=Object.create(l.prototype),b=function(t,e){this.state="off",this.index=0,this.spriteSheet=t,this.buttonList=e,this.setup()},b.prototype=Object.create(Golem.Util.EventEmitter),b.buttonStates=["on","off","disabled","mousedown","active","recharging"],b.classes=["golem-button"],b.prototype.setState=function(t,e){this.state=i.contains(b.buttonStates,t)?t:"off",this.renderSprite(),i.contains(["active","recharging"],t)&&(this.emit(t,this),this.setCountdown(t,e))},b.prototype.setIndex=function(t){this.index=t||0},b.prototype.render=function(t){var e,i,s;e=this.getSpriteData().rect,i=e.width,s=e.height,$(this.el).css({width:""+i+"px",height:""+s+"px",top:(t.row-1)*s,left:(t.column-1)*i}),this.renderSprite()},b.prototype.setup=function(){var t,n,o;t=e.createElement("div"),n=e.createElement("span"),o=new w,this.on("click",i.bind(this.onClick,this)).on("activeComplete",i.bind(this.setState,this,"recharging")).on("recharged",i.bind(this.setState,this,"on")),$(n).addClass("active-pulse"),$(t).addClass(b.classes.join(" ")).append(o.el).append(n),this.el=t,this.displayObject=new s.DOMElement(t),this.scrim=o,this.setupEvents()},b.prototype.onClick=function(){switch(this.state){case"on":i.contains(i.pluck(this.buttonList,"state"),"active")?this.emit("waiting",this):this.setState("active");break;case"recharging":this.emit("waiting",this)}},b.prototype.setupEvents=function(){var t,e,s;t=function(t){this.emit(t.type,t)},e=this.scrim,s=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mouseenter","mouseleave"].join(" "),$(this.el).on(s,i.bind(t,this)),i.each(["activeComplete","recharging","recharged"],function(s){e.on(s,i.bind(t,this,{type:s}))},this)},b.prototype.getSpriteData=function(){return this.spriteSheet._frames[this.index]},b.prototype.renderSprite=function(){var t,e,i;t=this.state,e=this.displayObject,this.setBackgroundSprite("off"!==t),i=b.classes.slice(),i.push("golem-button-"+t),this.queued&&i.push("queued"),$(this.el).removeClass().addClass(i.join(" "))},b.prototype.setBackgroundSprite=function(t){var e,i,s,n;t?(e=this.getSpriteData(),i=e.image,s=e.rect,n={background:["url('"+i.src+"')",""+-s.x+"px",""+-s.y+"px","no-repeat","transparent"].join(" ")}):n={background:"none"},$(this.el).css(n)},b.prototype.setCountdown=function(t,e){this.scrim.setCountdown(t||this.state,e)},b.prototype.setActiveTime=function(t){this.scrim.setActiveTime(t||0)},b.prototype.setRechargingTime=function(t){this.scrim.setRechargingTime(t||0)},w=function(t){this.options=i.extend({size:50,backgroundColor:"#000"},t),this.buildElements(),this.remaining=-1},w.prototype=Object.create(Golem.Util.EventEmitter),w.prototype.buildElements=function(){var t,n,o,a,r,h,c,p,d,l,u,g,f,m,y,v,b,w,x,C,T;y=this.options,a=this.options.size,r=Math.ceil(a*Math.sqrt(2)),f=Math.round(r/2),l=""+a+"px",g=""+r+"px",m=""+-Math.round((r-a)/2)+"px",t=e.createElement("div"),h=e.createElement("div"),c=e.createElement("div"),n=e.createElement("div"),o=e.createElement("div"),T=e.createElement("p"),$(T).addClass("text").css({width:l,height:l,lineHeight:l}),p=[0,g,g,""+f+"px"].join(" "),d=[0,""+f+"px",g,0].join(" "),b={width:g,height:g,backgroundColor:y.backgroundColor,clip:"rect("+p+")"},u={width:g,height:g,top:m,left:m,clip:"rect("+p+")"},$(n).addClass("half").css(b),b.clip="rect("+d+")",$(o).addClass("half").css(b),$(h).addClass("clip").css(u).append(n),u.clip="rect("+d+")",$(c).addClass("clip").css(u).append(o),$(t).addClass("golem-scrim").css({width:l,height:l}).append(h).append(c).append(T),this.el=t,this.text=T,v=s.DOMElement,w=new v(n),x=new v(o),C=[w,x],i.each(C,function(t){t.regX=f,t.regY=f,t.x=f,t.y=f,t.rotation=0}),this.displayObjects=C},w.prototype.rotate=function(t){var e,i;i=t>=180,e=this.displayObjects,e[0].rotation=i?180.001:t,e[1].rotation=i?-(180.001-t):0},w.prototype.setActiveTime=function(t){this.activeTime=1e3*t},w.prototype.setRechargingTime=function(t){this.rechargingTime=1e3*t},w.prototype.setCountdown=function(t,e){this.state=t,this.time=this[t+"Time"],this.remaining=i.isNumber(e)?1e3*e:this.time,this.lastTick=(new Date).getTime()},w.prototype.tick=function(){var t,e,i,s;t=this.remaining,t>0?(i=(new Date).getTime(),e=i-this.lastTick,t=Math.max(t-e,0),"recharging"===this.state&&(s=360-360*(t/this.time),this.rotate(parseFloat(s.toFixed(3))),this.text.textContent=(t/1e3).toFixed(1)),this.lastTick=i,this.remaining=t):0===parseInt(t,10)&&(this.remaining=-1,this.emit("recharging"===this.state?"recharged":"activeComplete"))},v=function(t,e){l.call(this,e),t=i.extend({classes:["golem-container","golem-button-bar"]},t),this.parent=$(t.parent||"body"),this.buttons=[],this.queuedButton=null,this.setDimensions(t.rows||1,t.columns||4),this.setupSpriteSheet(t.spriteSheet),this.setupButtons(t.buttons),this.setWidthHeight(),this.setupHTML(t),this.setupFillBar()},v.prototype=Object.create(u.prototype),v.prototype.setupButtons=function(t){var e,n,o,a,r,h,c,p,d,l;for(c=this.stage,n=this.list,l=c.addChild,e=n.length,r=this.spriteSheet,t=t||[],d=[],o=0;e>o;o++)i.isUndefined(n[o])&&(a=new b(r,n),this.add(a,o),p=a.scrim,l.apply(c,[a.displayObject].concat(p.displayObjects)),h=t[o],h&&this.updateButton(o,h),d.push(p),a.on("waiting",i.bind(this.updateQueue,this)).on("activeComplete",i.bind(this.deQueue,this)).on("recharged",i.bind(this.deQueueIfMatching,this,a)).on("active",i.bind(function(t){var e=t.scrim;this.dumpQueue.apply(this,Array.prototype.slice(arguments,0)),e.activeTime>0&&this.fillBar.setTargetValue(100,e.activeTime)},this)));s.Ticker.addListener(i.bind(i.each,this,d,function(t){t.tick()}))},v.prototype.setupFillBar=function(){var t,e;t=l.buildWidget({type:"FillBar",width:this.width/2,targetValue:0,x:this.optionX,y:this.optionY,offsetY:this.height+20},this.stage),e=t.container,e.alpha=0,this.fillBar=t,this.stage.addChild(e),this.addChild(t)},v.prototype.updateQueue=function(t){var e=this.queuedButton;i.isNull(e)||(e.queued=!1,e.renderSprite()),this.queuedButton=t,t.queued=!0,t.renderSprite()},v.prototype.deQueue=function(){var t=this.queuedButton;i.isNull(t)||(this.queuedButton=null,t.queued=!1,t.emit("click"))},v.prototype.deQueueIfMatching=function(t){var e=this.queuedButton;e===t&&(this.queuedButton=null,t.queued=!1,t.emit("click"))},v.prototype.dumpQueue=function(){var t;t=this.queuedButton,i.isNull(t)||(this.queuedButton=null,t.queued=!1,t.renderSprite())},v.prototype.updateButton=function(t,e){var s=this.get(t);e=i.extend({index:s.index,activeTime:s.activeTime,rechargingTime:s.rechargingTime,state:s.state,activeTimeRemaining:s.activeTimeRemaining,rechargeTimeRemaining:s.rechargeTimeRemaining},e),s.setIndex(e.index),s.setActiveTime(e.activeTime),s.setRechargingTime(e.rechargingTime),s.setState(e.state,e.activeTimeRemaining||e.rechargeTimeRemaining)},v.prototype.render=function(){var t,e;t=$(this.el),e=this.spriteSheet,i.each(this.list,function(e,i){e.render(this.getPosition(i)),t.append(e.el)},this),this.parent.append(t)},v.prototype.reposition=function(t,e){var i=this.displayObject;i.x=this.getNormalizedX()+t,i.y=this.getNormalizedY()+e},y=function(t,e){l.call(this,e),t=i.extend({x:"middle",y:"middle",width:100,height:20,max:100,value:0,targetValue:100,duration:2,borderColor:"#ccc",fillColor:"rgb(245, 245, 220)"},t),this.drawShapes(t),this.max=t.max,this.value=t.value,this.targetValue=t.targetValue,this.duration=1e3*t.duration,this.lastTick=(new Date).getTime(),s.Ticker.addListener(i.bind(this.tick,this))},y.prototype=Object.create(g.prototype),y.prototype.reposition=function(){var t;t=this.container,t.x=this.getNormalizedX(),t.y=this.getNormalizedY()},y.prototype.drawShapes=function(t){var e,i,n;e=new s.Container,i=new s.Shape,this.optionX=t.x,this.optionY=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.width=t.width,this.height=t.height,this.fillColor=t.fillColor,this.borderColor=t.borderColor,this.height=t.height,i.graphics.beginFill(t.borderColor).drawRoundRect(0,0,t.width,t.height,4),n=new s.Shape,e.addChild(i),e.addChild(n),this.container=e,this.fill=n},y.prototype.drawFillPosition=function(){this.fill.graphics.clear().beginFill(this.fillColor).drawRoundRect(2,2,(this.width-4)/this.max*this.value,this.height-4,2)},y.prototype.render=function(){this.stage.addChild(this.container)},y.prototype.tick=function(){var t,e,i,s,n;t=this.value,e=this.targetValue,n=this.duration,i=(new Date).getTime(),s=i-this.lastTick,t>e?(this.value=Math.max(e,t-s/n*this.max),this.drawFillPosition()):e>t&&(this.value=Math.min(e,t+s/n*this.max),this.drawFillPosition()),this.lastTick=i},y.prototype.setTargetValue=function(t,e){var i=this.container;this.lastTick=(new Date).getTime(),this.targetValue=t,t!==this.value&&(this.duration=e||1e3,s.Tween.get(i).to({alpha:1}))};var x={Collection:u,ButtonBar:v,Data:g,FillBar:y,Menu:f,Utility:m}}(this,document,_,createjs);