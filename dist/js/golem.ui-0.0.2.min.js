this.Golem=this.Golem||{},function(t,e,i,s,n,o){"use strict";var a,r,h,c=/\s+/;a={},a.checkExists=function(e,s,n){var o,a;return o=s||t,i.isArray(e)?i.each(e,function(e){return i.each(e.split("."),function(t){o=o[t]}),a=!i.isUndefined(o),h(e,a,n),o=s||t,a},this):(i.each(e.split("."),function(t){o=o[t]}),a=!i.isUndefined(o),h(e,a,n)),a},r={},r.on=function(t,e,s){var n,o;return i.isFunction(e)&&(t=t.split(c),n=this._eventRegistry||(this._eventRegistry={}),i.each(t,function(t){o=n[t]||(n[t]=[]),o.push(e,s)})),this},r.off=function(t,e,s){var n,o,a;return n=this._eventRegistry,n&&(t||e||s?(t=t?t.split(c):i.keys(n),i.each(t,function(t){if(o=n[t],o&&(e||s))for(a=o.length-2;a>=0;a-=2)e&&o[a]!==e||s&&o[a+1]!==s||o.splice(a,2);else delete n[t]})):delete this._eventRegistry),this},r.emit=function(t){var e,s,n,o,a,r,h;if(e=this._eventRegistry){for(h=[],t=t.split(c),n=1,o=arguments.length;o>n;n++)h[n-1]=arguments[n];i.each(t,function(t){if(r=(e.all||[]).slice(),s=(e[t]||[]).slice(),s.length)for(n=0,o=s.length;o>n;n+=2)s[n].apply(s[n+1]||this,h);if(r.length)for(a=[t].concat(h),n=0,o=r.length;o>n;n+=2)r[n].apply(r[n+1]||this,a)})}return this},a.EventEmitter=r,h=function(t,e,i){i||e||console.log(t+" is undefined.")},i.extend(t.Golem,{Util:a});var p;p=function(t){Golem.Util.checkExists(["createjs.PreloadJS"]),this.p=new n.PreloadJS,this.manifest=i.isUndefined(t)?[]:t,this.head=e.getElementsByTagName("head")[0],this.body=e.body,this.loaded=!1},p.prototype.addAsset=function(t,e){var s=this.loaded;return i.isArray(t)?this.manifest=this.manifest.concat(t):this.manifest.push(t),(s||i.isFunction(e))&&this.load(e),s},p.prototype.init=function(t){this.p.onFileLoad=i.bind(this.handleFile,this),this.load(t)},p.prototype.load=function(t){var e=this.p;this.loaded=!0,e.onComplete=this.getCallback(t),e.loadManifest(this.manifest)},p.prototype.handleFile=function(t){var i=n.PreloadJS;switch(t.type){case i.CSS:this.head.appendChild(t.result);break;case i.JAVASCRIPT:e.body.appendChild(t.result);break;case i.SOUND:this.body.appendChild(t.result);break;case i.IMAGE:break;case i.JSON:break;case i.XML:}},p.prototype.getCallback=function(e){var s,n,o;return n=this.p,o=this.manifest,e=i.isFunction(e)?e:function(){},s=i.bind(function(){var n=i.all(o,function(e){var s,n;return"js"===i.last(e.src.split("."))?(s=e.id.split("."),n=t,i.each(s,function(t){n=n[t]})):n=!0,!i.isUndefined(n)});n?(this.manifest=[],e()):setTimeout(s,1)},this)},i.extend(t.Golem,{Preload:p});var d,l;d=function(t){this.widgets=[],t=t||{},this.canvas=t.canvas||d.createCanvas(),this.options=i.extend({},t,{canvas:o}),this.prepareCanvas(),this.loadStage(),this.resizeCanvas(),this.setupTicker(t)},d.prototype.addWidget=function(t){var e,i=d.Widget,s=this.stage;return e=t instanceof i?t:i.buildWidget(t,s),this.widgets.push(e),s.addChild(e.displayObject),e},d.prototype.loadStage=function(t){var e=this.canvas;e&&(t=t||this.options.stage||new n.Stage(e)),this.stage=t},d.prototype.prepareCanvas=function(){s(this.canvas).addClass("golem-stage"),t.onresize=i.bind(this.resizeCanvas,this)},d.prototype.render=function(){this.startTicker(),this.renderWidgets()},d.prototype.renderWidgets=function(){this.repositionWidgets(),i.each(this.widgets,function(t){t.render()})},d.prototype.resizeCanvas=function(){var e,s,n,o,a,r,h,c,p,d,l,u;s=this.canvas,e=this.options,c=t.innerWidth,p=t.innerHeight,d=c/p,l=e.viewportRatio||.98,h=e.aspectRatio||8/6,h>=d?(n=c*l,o=n/h):(o=p*l,n=o*h),a=((c-n)/2).toFixed(0),r=((p-o)/2).toFixed(0),i.extend(s.style,{position:"fixed",left:a+"px",top:r+"px"}),s.setAttribute("width",n),s.setAttribute("height",o),u=this.stage,this.left=parseInt(a,10),this.top=parseInt(r,10),this.width=n,this.height=o,this.repositionWidgets()},d.prototype.repositionWidgets=function(){var t,e;t=this.left,e=this.top,i.each(this.widgets,function(s){s.reposition(t,e),i.each(s.children,function(i){i.reposition(t,e)})})},l=function(){this.stage.update()},d.prototype.startTicker=function(){n.Ticker.addListener(i.bind(l,this))},d.prototype.setupTicker=function(t){var e=n.Ticker;t=i.extend({},t),e.useRAF=t.useRAF||!0,e.setFPS(t.FPS||60)},d.createCanvas=function(){var t=e.createElement("canvas");return t},i.extend(t.Golem,{UI:d});var u,g,f,m,y,v,b,w,x;u=function(t){this.stage=t},u.prototype=Object.create(Golem.Util.EventEmitter),u.buildWidget=function(t,e){var i=new C[t.type](t,e);return i},u.prototype.children=[],u.prototype.addChild=function(t){this.children.push(t)},u.prototype.getNormalizedX=function(){return u.getNormalizedPositionValue(this.optionX,this.width,s(this.stage.canvas).width(),this.offsetX)},u.prototype.getNormalizedY=function(){return u.getNormalizedPositionValue(this.optionY,this.height,s(this.stage.canvas).height(),this.offsetY)},u.getNormalizedPositionValue=function(t,e,s,n){if(i.isString(t))switch(n=n||0,t){case"top":case"left":t=n;break;case"middle":t=(s-e)/2+n;break;case"right":case"bottom":t=s-e-n}return parseInt(t,10)},u.prototype.render=function(){},u.prototype.setupHTML=function(t){var i,o,a,r,h;a=["golem-widget"].concat(t.classes),t.className&&a.push(t.className),i=e.createElement("div"),this.optionX=t.x,this.optionY=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,r=this.getNormalizedX(),h=this.getNormalizedY(),o=new n.DOMElement(i),o.x=r,o.x=h,this.x=r,this.y=h,this.isHTML=!0,this.el=i,this.displayObject=o,s(this.el).css({height:this.height,width:this.width}).addClass(a.join(" "))},u.prototype.setupSpriteSheet=function(t){i.isUndefined(t)||(this.spriteSheet=new n.SpriteSheet(t),console.log(this.spriteSheet))},u.prototype.setWidthHeight=function(){var t,e,i,s;t=this.spriteSheet,e=this.dimensions,i=t._frameWidth*e[1],s=t._frameHeight*e[0],this.width=i,this.height=s},Golem.UI.Widget=u,g=function(){this.setDimensions(1,4)},g.prototype=Object.create(u.prototype),g.prototype.list=[],g.prototype.overflow=[],g.prototype.setDimensions=function(t,e){var s,n;return n=this.lastIndex=t*e-1,s=i.compact(this.list),this.dimensions=[t,e],s.length>n?this.addToOverflow(s.splice(n)):s.length=n+1,this.list=s,this},g.prototype.addToOverflow=function(t){var e=this.overflow;i.isArray(t)?e.concat(t):e.push(t),this.emit("overflow",t,e)},g.prototype.add=function(t,e){var s,n,o,a,r,h;if(o=this.lastIndex,s=this.list,i.isObject(e))e=this.getPosition(e);else if(i.isUndefined(e))for(e=-1,r=s.length,a=0;r>=a;++a)if(i.isUndefined(s[a])){e=a;break}return h={item:t,index:e,lastIndex:o},o>=e?(n=s[e],s[e]=t,i.extend(h,{type:"add",replaced:n})):i.extend(h,{type:"outOfBounds"}),this.emit(h.type,h),this},g.prototype.get=function(t){var e;return i.isObject(t)&&(t=this.getPosition(t)),e=this.list[t]},g.prototype.getPosition=function(t){var e,s,n,o;return e=this.dimensions[1],i.isObject(t)?o=(t.row-1)*e+t.column-1:(s=this.dimensions[0],n=Math.floor(t/e)+1,o={row:n,column:t-(n-1)*e+1}),o},f=function(){},f.prototype=Object.create(u.prototype),m=function(){},m.prototype=Object.create(u.prototype),y=function(){},y.prototype=Object.create(u.prototype),w=function(t,e){this.state="off",this.index=0,this.spriteSheet=t,this.buttonList=e,this.setup()},w.prototype=Object.create(Golem.Util.EventEmitter),w.buttonStates=["on","off","disabled","mousedown","active","recharging"],w.classes=["golem-button"],w.prototype.setState=function(t,e){this.state=i.contains(w.buttonStates,t)?t:"off",this.renderSprite(),i.contains(["active","recharging"],t)&&(this.emit(t,this),this.setCountdown(t,e))},w.prototype.setIndex=function(t){this.index=t||0},w.prototype.render=function(t){var e,i,n;e=this.getSpriteData().rect,i=e.width,n=e.height,s(this.el).css({width:""+i+"px",height:""+n+"px",top:(t.row-1)*n,left:(t.column-1)*i}),this.renderSprite()},w.prototype.setup=function(){var t,o,a;t=e.createElement("div"),o=e.createElement("span"),a=new x,this.on("click",i.bind(this.onClick,this)).on("activeComplete",i.bind(this.setState,this,"recharging")).on("recharged",i.bind(this.setState,this,"on")),s(o).addClass("active-pulse"),s(t).addClass(w.classes.join(" ")).append(a.el).append(o),this.el=t,this.displayObject=new n.DOMElement(t),this.scrim=a,this.setupEvents()},w.prototype.onClick=function(){switch(this.state){case"on":i.contains(i.pluck(this.buttonList,"state"),"active")?this.emit("waiting",this):this.setState("active");break;case"recharging":this.emit("waiting",this)}},w.prototype.setupEvents=function(){var t,e,n;t=function(t){this.emit(t.type,t)},e=this.scrim,n=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mouseenter","mouseleave"].join(" "),s(this.el).on(n,i.bind(t,this)),i.each(["activeComplete","recharging","recharged"],function(s){e.on(s,i.bind(t,this,{type:s}))},this)},w.prototype.getSpriteData=function(){return this.spriteSheet._frames[this.index]},w.prototype.renderSprite=function(){var t,e,i;t=this.state,e=this.displayObject,this.setBackgroundSprite("off"!==t),i=w.classes.slice(),i.push("golem-button-"+t),this.queued&&i.push("queued"),s(this.el).removeClass().addClass(i.join(" "))},w.prototype.setBackgroundSprite=function(t){var e,i,n,o;t?(e=this.getSpriteData(),i=e.image,n=e.rect,o={background:["url('"+i.src+"')",""+-n.x+"px",""+-n.y+"px","no-repeat","transparent"].join(" ")}):o={background:"none"},s(this.el).css(o)},w.prototype.setCountdown=function(t,e){this.scrim.setCountdown(t||this.state,e)},w.prototype.setActiveTime=function(t){this.scrim.setActiveTime(t||0)},w.prototype.setRechargingTime=function(t){this.scrim.setRechargingTime(t||0)},x=function(t){this.options=i.extend({size:50,backgroundColor:"#000"},t),this.buildElements(),this.remaining=-1},x.prototype=Object.create(Golem.Util.EventEmitter),x.prototype.buildElements=function(){var t,o,a,r,h,c,p,d,l,u,g,f,m,y,v,b,w,x,C,T,S;v=this.options,r=this.options.size,h=Math.ceil(r*Math.sqrt(2)),m=Math.round(h/2),u=""+r+"px",f=""+h+"px",y=""+-Math.round((h-r)/2)+"px",t=e.createElement("div"),c=e.createElement("div"),p=e.createElement("div"),o=e.createElement("div"),a=e.createElement("div"),S=e.createElement("p"),s(S).addClass("text").css({width:u,height:u,lineHeight:u}),d=[0,f,f,""+m+"px"].join(" "),l=[0,""+m+"px",f,0].join(" "),w={width:f,height:f,backgroundColor:v.backgroundColor,clip:"rect("+d+")"},g={width:f,height:f,top:y,left:y,clip:"rect("+d+")"},s(o).addClass("half").css(w),w.clip="rect("+l+")",s(a).addClass("half").css(w),s(c).addClass("clip").css(g).append(o),g.clip="rect("+l+")",s(p).addClass("clip").css(g).append(a),s(t).addClass("golem-scrim").css({width:u,height:u}).append(c).append(p).append(S),this.el=t,this.text=S,b=n.DOMElement,x=new b(o),C=new b(a),T=[x,C],i.each(T,function(t){t.regX=m,t.regY=m,t.x=m,t.y=m,t.rotation=0}),this.displayObjects=T},x.prototype.rotate=function(t){var e,i;i=t>=180,e=this.displayObjects,e[0].rotation=i?180.001:t,e[1].rotation=i?-(180.001-t):0},x.prototype.setActiveTime=function(t){this.activeTime=1e3*t},x.prototype.setRechargingTime=function(t){this.rechargingTime=1e3*t},x.prototype.setCountdown=function(t,e){this.state=t,this.time=this[t+"Time"],this.remaining=i.isNumber(e)?1e3*e:this.time,this.lastTick=(new Date).getTime()},x.prototype.tick=function(){var t,e,i,s;t=this.remaining,t>0?(i=(new Date).getTime(),e=i-this.lastTick,t=Math.max(t-e,0),"recharging"===this.state&&(s=360-360*(t/this.time),this.rotate(parseFloat(s.toFixed(3))),this.text.textContent=(t/1e3).toFixed(1)),this.lastTick=i,this.remaining=t):0===parseInt(t,10)&&(this.remaining=-1,this.emit("recharging"===this.state?"recharged":"activeComplete"))},b=function(t,e){u.call(this,e),t=i.extend({classes:["golem-container","golem-button-bar"]},t),this.parent=s(t.parent||"body"),this.buttons=[],this.queuedButton=null,this.setDimensions(t.rows||1,t.columns||4),this.setupSpriteSheet(t.spriteSheet),this.setupButtons(t.buttons),this.setWidthHeight(),this.setupHTML(t),this.setupFillBar()},b.prototype=Object.create(g.prototype),b.prototype.setupButtons=function(t){var e,s,o,a,r,h,c,p,d,l,u;for(c=this.stage,s=this.list,l=c.addChild,e=s.length,r=this.spriteSheet,t=t||[],d=[],u=i.bind(function(t){var e=t.scrim;this.dumpQueue.apply(this,Array.prototype.slice(arguments,0)),e.activeTime>0&&this.fillBar.setTargetValue(100,e.activeTime)},this),o=0;e>o;o++)i.isUndefined(s[o])&&(a=new w(r,s),this.add(a,o),p=a.scrim,l.apply(c,[a.displayObject].concat(p.displayObjects)),h=t[o],h&&this.updateButton(o,h),d.push(p),a.on("waiting",i.bind(this.updateQueue,this)).on("activeComplete",i.bind(this.deQueue,this)).on("recharged",i.bind(this.deQueueIfMatching,this,a)).on("active",u));n.Ticker.addListener(i.bind(i.each,this,d,function(t){t.tick()}))},b.prototype.setupFillBar=function(){var t,e;t=u.buildWidget({type:"FillBar",width:this.width/2,targetValue:0,x:this.optionX,y:this.optionY,offsetY:this.height+20},this.stage),e=t.container,e.alpha=0,this.fillBar=t,this.stage.addChild(e),this.addChild(t)},b.prototype.updateQueue=function(t){var e=this.queuedButton;i.isNull(e)||(e.queued=!1,e.renderSprite()),this.queuedButton=t,t.queued=!0,t.renderSprite()},b.prototype.deQueue=function(){var t=this.queuedButton;i.isNull(t)||(this.queuedButton=null,t.queued=!1,t.emit("click"))},b.prototype.deQueueIfMatching=function(t){var e=this.queuedButton;e===t&&(this.queuedButton=null,t.queued=!1,t.emit("click"))},b.prototype.dumpQueue=function(){var t;t=this.queuedButton,i.isNull(t)||(this.queuedButton=null,t.queued=!1,t.renderSprite())},b.prototype.updateButton=function(t,e){var s=this.get(t);e=i.extend({index:s.index,activeTime:s.activeTime,rechargingTime:s.rechargingTime,state:s.state,activeTimeRemaining:s.activeTimeRemaining,rechargeTimeRemaining:s.rechargeTimeRemaining},e),s.setIndex(e.index),s.setActiveTime(e.activeTime),s.setRechargingTime(e.rechargingTime),s.setState(e.state,e.activeTimeRemaining||e.rechargeTimeRemaining)},b.prototype.render=function(){var t,e;t=s(this.el),e=this.spriteSheet,i.each(this.list,function(e,i){e.render(this.getPosition(i)),t.append(e.el)},this),this.parent.append(t)},b.prototype.reposition=function(t,e){var i=this.displayObject;i.x=this.getNormalizedX()+t,i.y=this.getNormalizedY()+e},v=function(t,e){u.call(this,e),t=i.extend({x:"middle",y:"middle",width:100,height:20,max:100,value:0,targetValue:100,duration:2,borderColor:"#ccc",fillColor:"rgb(245, 245, 220)"},t),this.drawShapes(t),this.max=t.max,this.value=t.value,this.targetValue=t.targetValue,this.duration=1e3*t.duration,this.lastTick=(new Date).getTime(),n.Ticker.addListener(i.bind(this.tick,this))},v.prototype=Object.create(f.prototype),v.prototype.reposition=function(){var t;t=this.container,t.x=this.getNormalizedX(),t.y=this.getNormalizedY()},v.prototype.drawShapes=function(t){var e,i,s;e=new n.Container,i=new n.Shape,this.optionX=t.x,this.optionY=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.width=t.width,this.height=t.height,this.fillColor=t.fillColor,this.borderColor=t.borderColor,this.height=t.height,i.graphics.beginFill(t.borderColor).drawRoundRect(0,0,t.width,t.height,4),s=new n.Shape,e.addChild(i),e.addChild(s),this.container=e,this.fill=s},v.prototype.drawFillPosition=function(){this.fill.graphics.clear().beginFill(this.fillColor).drawRoundRect(2,2,(this.width-4)/this.max*this.value,this.height-4,2)},v.prototype.render=function(){this.stage.addChild(this.container)},v.prototype.tick=function(){var t,e,i,s,n;t=this.value,e=this.targetValue,n=this.duration,i=(new Date).getTime(),s=i-this.lastTick,t>e?(this.value=Math.max(e,t-s/n*this.max),this.drawFillPosition()):e>t&&(this.value=Math.min(e,t+s/n*this.max),this.drawFillPosition()),this.lastTick=i},v.prototype.setTargetValue=function(t,e){var i=this.container;this.lastTick=(new Date).getTime(),this.targetValue=t,t!==this.value&&(this.duration=e||1e3,n.Tween.get(i).to({alpha:1}))};var C={Collection:g,ButtonBar:b,Data:f,FillBar:v,Menu:m,Utility:y}}(this,document,_,jQuery,createjs);